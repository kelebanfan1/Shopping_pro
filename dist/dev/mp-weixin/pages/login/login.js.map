{"version":3,"file":"login.js","sources":["../../../../../src/pages/login/login.vue","../../../../../uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { postLoginWxMinAPI, postLoginWxMinSimple } from '@/services/login'\r\nimport { useMemberStore } from '@/stores/modules/member'\r\nimport type { LoginResult } from '@/types/member'\r\nimport { onLoad } from '@dcloudio/uni-app'\r\n//获取code 登陆凭证\r\nlet code = ''\r\nonLoad(async () => {\r\n  const res = await wx.login()\r\n  code = res.code\r\n})\r\n// 获取用户手机号码  需要企业认证apppId\r\nconst onGetPhoneNumber: UniHelper.ButtonOnGetphonenumber = async (ev) => {\r\n  //!非空断言 ! 对前面的参数使用\r\n  const encryptedData = ev.detail!.encryptedData!\r\n  const iv = ev.detail!.iv!\r\n  const res = await postLoginWxMinAPI({\r\n    code,\r\n    encryptedData,\r\n    iv,\r\n  })\r\n  loginSuccess(res.result)\r\n}\r\n//模拟手机号码快捷登录 个人练习\r\nconst getphoneNumberSimple = async () => {\r\n  //测试\r\n  // const res = await postLoginWxMinSimple('13123456789')\r\n  const res = await postLoginWxMinSimple('18088845335')\r\n  console.log(res)\r\n  loginSuccess(res.result)\r\n}\r\nconst loginSuccess = (profile: LoginResult) => {\r\n  //保存会员信息\r\n  const memberStore = useMemberStore()\r\n  memberStore.setProfile(profile)\r\n  //成功提示\r\n  uni.showToast({ icon: 'success', title: '模拟登录成功' })\r\n  setTimeout(() => {\r\n    //页面跳转\r\n    // uni.switchTab({ url: '/pages/my/my' })\r\n    uni.navigateBack()\r\n  }, 200)\r\n}\r\n</script>\r\n\r\n<template>\r\n  <view class=\"viewport\">\r\n    <view class=\"logo\">\r\n      <image\r\n        src=\"https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/images/logo_icon.png\"\r\n      ></image>\r\n    </view>\r\n    <view class=\"login\">\r\n      <!-- 网页端表单登录 -->\r\n      <!-- <input class=\"input\" type=\"text\" placeholder=\"请输入用户名/手机号码\" /> -->\r\n      <!-- <input class=\"input\" type=\"text\" password placeholder=\"请输入密码\" /> -->\r\n      <!-- <button class=\"button phone\">登录</button> -->\r\n\r\n      <!-- 小程序端授权登录 -->\r\n      <button class=\"button phone\" open-type=\"getPhoneNumber\" @getphonenumber=\"onGetPhoneNumber\">\r\n        <text class=\"icon icon-phone\"></text>\r\n        手机号快捷登录\r\n      </button>\r\n      <view class=\"extra\">\r\n        <view class=\"caption\">\r\n          <text>其他登录方式</text>\r\n        </view>\r\n        <view class=\"options\">\r\n          <!-- 通用模拟登录 -->\r\n          <button @tap=\"getphoneNumberSimple\">\r\n            <text class=\"icon icon-phone\">模拟快捷登录</text>\r\n          </button>\r\n        </view>\r\n      </view>\r\n      <view class=\"tips\">登录/注册即视为你同意《服务条款》和《小兔鲜儿隐私协议》</view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\npage {\r\n  height: 100%;\r\n}\r\n\r\n.viewport {\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%;\r\n  padding: 20rpx 40rpx;\r\n}\r\n\r\n.logo {\r\n  flex: 1;\r\n  text-align: center;\r\n  image {\r\n    width: 220rpx;\r\n    height: 220rpx;\r\n    margin-top: 15vh;\r\n  }\r\n}\r\n\r\n.login {\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 60vh;\r\n  padding: 40rpx 20rpx 20rpx;\r\n\r\n  .input {\r\n    width: 100%;\r\n    height: 80rpx;\r\n    font-size: 28rpx;\r\n    border-radius: 72rpx;\r\n    border: 1px solid #ddd;\r\n    padding-left: 30rpx;\r\n    margin-bottom: 20rpx;\r\n  }\r\n\r\n  .button {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    width: 100%;\r\n    height: 80rpx;\r\n    font-size: 28rpx;\r\n    border-radius: 72rpx;\r\n    color: #fff;\r\n    .icon {\r\n      font-size: 40rpx;\r\n      margin-right: 6rpx;\r\n    }\r\n  }\r\n\r\n  .phone {\r\n    background-color: #28bb9c;\r\n  }\r\n\r\n  .wechat {\r\n    background-color: #06c05f;\r\n  }\r\n\r\n  .extra {\r\n    flex: 1;\r\n    padding: 70rpx 70rpx 0;\r\n    .caption {\r\n      width: 440rpx;\r\n      line-height: 1;\r\n      border-top: 1rpx solid #ddd;\r\n      font-size: 26rpx;\r\n      color: #999;\r\n      position: relative;\r\n      text {\r\n        transform: translate(-40%);\r\n        background-color: #fff;\r\n        position: absolute;\r\n        top: -12rpx;\r\n        left: 50%;\r\n      }\r\n    }\r\n\r\n    .options {\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n      margin-top: 70rpx;\r\n      button {\r\n        padding: 0;\r\n        background-color: transparent;\r\n      }\r\n    }\r\n\r\n    .icon {\r\n      font-size: 24rpx;\r\n      color: #444;\r\n      display: flex;\r\n      flex-direction: column;\r\n      align-items: center;\r\n\r\n      &::before {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        width: 80rpx;\r\n        height: 80rpx;\r\n        margin-bottom: 6rpx;\r\n        font-size: 40rpx;\r\n        border: 1rpx solid #444;\r\n        border-radius: 50%;\r\n      }\r\n    }\r\n    .icon-weixin::before {\r\n      border-color: #06c05f;\r\n      color: #06c05f;\r\n    }\r\n  }\r\n}\r\n\r\n.tips {\r\n  position: absolute;\r\n  bottom: 80rpx;\r\n  left: 20rpx;\r\n  right: 20rpx;\r\n  font-size: 22rpx;\r\n  color: #999;\r\n  text-align: center;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'E:/uniapp-pro/heima-shop/src/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["onLoad","wx","postLoginWxMinAPI","postLoginWxMinSimple","useMemberStore","uni"],"mappings":";;;;;;;;;AAMA,QAAI,OAAO;AACXA,kBAAAA,OAAO,YAAY;AACX,YAAA,MAAM,MAAMC,mBAAG;AACrB,aAAO,IAAI;AAAA,IAAA,CACZ;AAEK,UAAA,mBAAqD,OAAO,OAAO;AAAA,MAAA;AAEjE,YAAA,gBAAgB,GAAG,OAAQ;AAC3B,YAAA,KAAK,GAAG,OAAQ;AAChB,YAAA,MAAM,MAAMC,iCAAkB;AAAA,QAClC;AAAA,QACA;AAAA,QACA;AAAA,MAAA,CACD;AACD,mBAAa,IAAI,MAAM;AAAA,IAAA;AAGzB,UAAM,uBAAuB,YAAY;AAGjC,YAAA,MAAM,MAAMC,oCAAqB,aAAa;AACpD,cAAQ,IAAI,GAAG;AACf,mBAAa,IAAI,MAAM;AAAA,IAAA;AAEnB,UAAA,eAAe,CAAC,YAAyB;AAE7C,YAAM,cAAcC,sBAAAA;AACpB,kBAAY,WAAW,OAAO;AAE9BC,oBAAA,MAAI,UAAU,EAAE,MAAM,WAAW,OAAO,UAAU;AAClD,iBAAW,MAAM;AAGfA,sBAAA,MAAI,aAAa;AAAA,SAChB,GAAG;AAAA,IAAA;;;;;;;;;;ACxCR,GAAG,WAAW,eAAe;"}